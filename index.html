<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>GatlingCql by Mishail</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>GatlingCql</h1>
        <p>Gatling support for Apache Cassandra CQL</p>
        <p class="view"><a href="https://github.com/Mishail/GatlingCql">View the Project on GitHub <small>Mishail/GatlingCql</small></a></p>
        <ul>
          <li><a href="https://github.com/Mishail/GatlingCql/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Mishail/GatlingCql/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Mishail/GatlingCql">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="gatlingcql" class="anchor" href="#gatlingcql" aria-hidden="true"><span class="octicon octicon-link"></span></a>GatlingCql</h1>

<p>Gatling DSL support for Apache Cassandra CQL</p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<p>Basic Gatling DSL for Apache Cassandra CQL, prepared statements are supported as well</p>

<div class="highlight highlight-source-scala"><pre><span class="pl-k">class</span> <span class="pl-en">CassandraSimulation</span> <span class="pl-k">extends</span> <span class="pl-e">Simulation</span> {
  <span class="pl-k">val</span> <span class="pl-en">keyspace</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>
  <span class="pl-k">val</span> <span class="pl-en">table_name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>
  <span class="pl-k">val</span> <span class="pl-en">session</span> <span class="pl-k">=</span> <span class="pl-en">Cluster</span>.builder().addContactPoint(<span class="pl-s"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>)
                  .build().connect(s<span class="pl-s"><span class="pl-pds">"</span>$keyspace<span class="pl-pds">"</span></span>) <span class="pl-c">//Your C* session</span>
  <span class="pl-k">val</span> <span class="pl-en">cqlConfig</span> <span class="pl-k">=</span> cql.session(session) <span class="pl-c">//Initialize Gatling DSL with your session</span>

  <span class="pl-c">//Setup</span>
  session.execute(s<span class="pl-s"><span class="pl-pds">"""</span>CREATE KEYSPACE IF NOT EXISTS $keyspace </span>
<span class="pl-s">                      WITH replication = { 'class' : 'SimpleStrategy', </span>
<span class="pl-s">                                          'replication_factor': '1'}<span class="pl-pds">"""</span></span>)
  session.execute(s<span class="pl-s"><span class="pl-pds">"""</span>CREATE TABLE IF NOT EXISTS $table_name (</span>
<span class="pl-s">          id timeuuid,</span>
<span class="pl-s">          num int,</span>
<span class="pl-s">          str text,</span>
<span class="pl-s">          PRIMARY KEY (id)</span>
<span class="pl-s">        );</span>
<span class="pl-s">      <span class="pl-pds">"""</span></span>)
  <span class="pl-c">//It's generally not advisable to use secondary indexes in you schema</span>
  session.execute(f<span class="pl-s"><span class="pl-pds">"""</span>CREATE INDEX IF NOT EXISTS $table_name%s_num_idx </span>
<span class="pl-s">                      ON $table_name%s (num)<span class="pl-pds">"""</span></span>)


  <span class="pl-c">//Prepare your statement, we want to be effective, right?</span>
  <span class="pl-k">val</span> <span class="pl-en">prepared</span> <span class="pl-k">=</span> session.prepare(s<span class="pl-s"><span class="pl-pds">"""</span>INSERT INTO $table_name </span>
<span class="pl-s">                                      (id, num, str) </span>
<span class="pl-s">                                      VALUES </span>
<span class="pl-s">                                      (now(), ?, ?)<span class="pl-pds">"""</span></span>)

  <span class="pl-k">val</span> <span class="pl-en">random</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">util.Random</span>
  <span class="pl-k">val</span> <span class="pl-en">feeder</span> <span class="pl-k">=</span> <span class="pl-en">Iterator</span>.continually( 
      <span class="pl-c">// this feader will "feed" random data into our Sessions</span>
      <span class="pl-en">Map</span>(
          <span class="pl-s"><span class="pl-pds">"</span>randomString<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> random.nextString(<span class="pl-c1">20</span>), 
          <span class="pl-s"><span class="pl-pds">"</span>randomNum<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> random.nextInt()
          ))

  <span class="pl-k">val</span> <span class="pl-en">scn</span> <span class="pl-k">=</span> scenario(<span class="pl-s"><span class="pl-pds">"</span>Two statements<span class="pl-pds">"</span></span>).repeat(<span class="pl-c1">1</span>) { <span class="pl-c">//Name your scenario</span>
    feed(feeder)
    .exec(cql(<span class="pl-s"><span class="pl-pds">"</span>simple SELECT<span class="pl-pds">"</span></span>) 
         <span class="pl-c">// 'execute' can accept a string </span>
         <span class="pl-c">// and understands Gatling expression language (EL), i.e. ${randomNum}</span>
        .execute(<span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM test_table WHERE num = ${randomNum}<span class="pl-pds">"</span></span>)) 
    .exec(cql(<span class="pl-s"><span class="pl-pds">"</span>prepared INSERT<span class="pl-pds">"</span></span>)
         <span class="pl-c">// alternatively 'execute' accepts a prepared statement</span>
        .execute(prepared)
         <span class="pl-c">// you need to provide parameters for that (EL is supported as well)</span>
        .withParams(<span class="pl-en">Integer</span>.valueOf(random.nextInt()), <span class="pl-s"><span class="pl-pds">"</span>${randomString}<span class="pl-pds">"</span></span>)
        <span class="pl-c">// and set a ConsistencyLevel optionally</span>
        .consistencyLevel(<span class="pl-en">ConsistencyLevel</span>.<span class="pl-en">ANY</span>)) 
  }

  setUp(scn.inject(rampUsersPerSec(<span class="pl-c1">10</span>) to <span class="pl-c1">100</span> during (<span class="pl-c1">30</span> seconds)))
    .protocols(cqlConfig)
}</pre></div>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<ul>
<li>Get a release TGZ</li>
<li>Unpack into Gatling folder: <code>tar -xjf GatlingCql-0.0.3-release.tar.gz -C gatling-charts-highcharts-bundle-2.1.7/</code>
</li>
<li>Run Gatling and you should see <code>cassandra.CassandraSimulation</code> in your simulations list</li>
</ul>

<h2>
<a id="more-information" class="anchor" href="#more-information" aria-hidden="true"><span class="octicon octicon-link"></span></a>More Information</h2>

<ul>
<li><a href="http://gatling.io/docs/2.1.7/quickstart.html">http://gatling.io/docs/2.1.7/quickstart.html</a></li>
<li><a href="http://gatling.io/docs/2.1.7/cheat-sheet.html">http://gatling.io/docs/2.1.7/cheat-sheet.html</a></li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/Mishail">Mishail</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54902747-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
